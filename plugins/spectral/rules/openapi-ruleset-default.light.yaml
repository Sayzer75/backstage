extends: spectral:oas
rules:
  error-response:
    description: Error responses must have a schema.
    severity: error
    given: $.paths.*[get,post,put,delete,patch].responses[4**,5**]
    then:
      field: content.application/json.schema
      function: truthy

  rate-limit-response:
    description: APIs should document rate limit headers.
    severity: warn
    given: $.paths.*[get,post,put,delete,patch].responses[2**].headers
    then:
      field: "X-RateLimit-Limit"
      function: truthy

  operation-summary:
    description: Operations should have a summary.
    severity: warn
    given: $.paths.*[get,post,put,delete,patch]
    then:
      field: summary
      function: truthy
  
  health-check-endpoint:
    description: API should have a health check endpoint.
    severity: warn
    given: $.paths
    then:
      function: truthy
      field: "/health"

  detect-deprecated-operation:
    description: Detect and warn about deprecated API operations
    severity: warn
    given: $.paths.[*][get,put,post,delete,patch,options,head]
    then:
      - field: deprecated
        function: truthy
        
  warn-deprecated-description-en:
    description: Check for deprecation indicators in operation descriptions
    severity: warn
    given: $.paths.[*][get,put,post,delete,patch,options,head].description
    then:
      - function: pattern
        functionOptions:
          notMatch: /\b(deprecated|will be removed|no longer supported)\b/i
          
  recommend-replacement-en:
    description: Suggest replacement for deprecated operations
    severity: hint
    given: $.paths.[*][get,put,post,delete,patch,options,head]
    then:
      - field: description
        function: pattern
        functionOptions:
          match: /use\s+\w+\s+instead/i

  warn-deprecated-description-fr:
    description: Check for deprecation indicators in operation descriptions
    severity: warn
    given: $.paths.[*][get,put,post,delete,patch,options,head].description
    then:
      - function: pattern
        functionOptions:
          notMatch: /\b(obsolète|sera supprimé|n'est plus pris en charge)\b/i
          
  recommend-replacement-fr:
    description: Suggest replacement for deprecated operations
    severity: hint
    given: $.paths.[*][get,put,post,delete,patch,options,head]
    then:
      - field: description
        function: pattern
        functionOptions:
          match: /utiliser\s+\w+\s+à la place/i
