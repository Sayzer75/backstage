extends: spectral:oas
rules:
  error-response:
    description: Error responses must have a schema.
    severity: error
    given: $.paths.*[get,post,put,delete,patch].responses[4**,5**]
    then:
      field: content.application/json.schema
      function: truthy

  rate-limit-response:
    description: APIs should document rate limit headers.
    severity: warn
    given: $.paths.*[get,post,put,delete,patch].responses[2**].headers
    then:
      field: "X-RateLimit-Limit"
      function: truthy

  operation-summary:
    description: Operations should have a summary.
    severity: warn
    given: $.paths.*[get,post,put,delete,patch]
    then:
      field: summary
      function: truthy
  
  health-check-endpoint:
    description: API should have a health check endpoint.
    severity: warn
    given: $.paths
    then:
      function: truthy
      field: "/health"

  remove-deprecated-operation:
    description: Deprecated API operations should be removed as soon as possible.
    severity: info
    given: $.paths.[*][get,put,post,delete,patch,options,head]
    then:
      - field: deprecated
        function: truthy